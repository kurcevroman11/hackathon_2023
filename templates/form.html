{{define "index"}}

{{template "head" }}

<body>

    {{template "header" }}

    <div class="container mt-3">
        <input type="text" id="title" placeholder="Введите название статьи" class="form-control"><br>
        <input type="text" id="subtitle" placeholder="Введите подзаголовок статьи" class="form-control"><br>
        <input type="text" id="createAt" class="form-control mb-3" placeholder="Введите подзаголовок статьи" value="" readonly>
            <h3>Выбор темы</h3>
        <label for="theme" class=" mb-3" >Выберите тему:</label>

        <div id="theme" class="themesArticle">
        {{range $index, $item := . }}
            <button class = "colorThemes me-2 mb-4" style="background-color: {{ $item.Color }};" onclick="selectTheme('{{$item.Id}}')"></button>
        {{end}}
        </div>
        <script>
            // Получить текущую дату
            var currentDate = new Date();

            // Форматировать дату в строку (например, "dd.mm.yyyy")
            var formattedDate = currentDate.getDate() + '.' + (currentDate.getMonth() + 1) + '.' + currentDate.getFullYear();

            // Установить отформатированную дату в поле ввода
            document.getElementById("createAt").value = formattedDate;
        </script>
        <div id="editor" name="editor" placeholder="Введите текст статьи" class="h-50 p3 "></div>
        <button class="btn btn-primary mt-2" id="saveButton">Добавить</button>
    </div>


    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        var selectedTheme = {}; // Объект для хранения выбранной темы

        function selectTheme(ID) {
            // Отправить запрос на сервер
            fetch(`/theme/${ID}`, { method: 'GET' })
                .then(function(response) {
                    if (response.status === 200) {
                        response.json().then(function(data) {
                                // Обновить selectedTheme на основе данных с сервера
                                selectedTheme = {
                                    id: ID,
                                    name: data.name,
                                    color: data.color,
                                    image: data.image,
                                };
                                console.log(selectedTheme)

                        });
                    } else {
                        console.error('Ошибка при отправке запроса на сервер:', response.statusText);
                        return null;
                    }
                })

                .catch(function(error) {
                    console.error('Ошибка при получении данных с сервера:', error);
                });

            // При необходимости вы можете также обновить пользовательский интерфейс, чтобы указать выбранную тему.
        }

        var quill = new Quill('#editor', {
            theme: 'snow', // Тема редактора (по умолчанию "snow")

            // Настройки панели инструментов
            modules: {
                toolbar: [
                    [{ 'header': '1' }, { 'header': '2' }],
                    ['bold', 'italic', 'underline', 'strike'],
                    ['link', 'image'],
                    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                    [{ 'align': [] }],
                    ['clean'],
                    [{'font': []}],

                ]
            },

            // Настройки форматирования текста
            formats: [
                'header', 'bold', 'italic', 'underline', 'strike',
                'link','image', 'list', 'align', "font",
            ]
        });

        // Обработка события изменения контента
        quill.on('text-change', function(delta, oldDelta, source) {
            // Здесь вы можете обрабатывать изменения текста
            console.log('Text changed:', delta);
        });
        // Получение кнопки по ее ID
        var saveButton = document.getElementById('saveButton');


        // Добавление обработчика события на клик кнопки
        saveButton.addEventListener('click', function() {
            titleInput = document.getElementById("title")
            subtitleInput = document.getElementById("subtitle")
            createAtInput = document.getElementById("createAt")
            editorContent = document.getElementById("editor")

            if (titleInput.value.trim() === '' || subtitleInput.value.trim() === '' || createAtInput.value.trim() === '' || editorContent.trim() === '') {
                alert('Пожалуйста, заполните все поля.');
                return; // Не выполняем отправку данных
            }else {
                // Вызов функции sendArticleContent при клике
                sendArticleContent();
            }
        });
        // Получение содержимого редактора
        function getEditorContent() {
            var content = quill.root.innerHTML;
            console.log('Editor content:', content);
        }

        // Установка содержимого редактора
        function sendArticleContent() {
            // Получение содержимого редактора
            var content = quill.root.innerHTML;
            var titleInput = document.getElementById('title');
            var Subtitle = document.getElementById('Subtitle');
            var CreateAt = document.getElementById('CreateAt');
            var theme = selectedTheme;

// Получение значения из элемента
            var SubtitleValue = Subtitle.value;
            var CreateAtValue = CreateAt.value;
            var titleValue = titleInput.value;

            console.log(titleValue)

            // Создание объекта для отправки данных
            var data = {
                Title:titleValue,
                Subtitle: SubtitleValue,
                Content: content,
                Theme: theme,
                CreateAt: CreateAtValue,
            };

            // Опции для POST-запроса
            var options = {
                method: 'POST',
                body: JSON.stringify(data),
                headers: {
                    'Content-Type': 'application/json'
                }
            };

            // Отправка POST-запроса
            fetch('/articles', options)
                .then(function(response) {
                    if (response.status === 201) {
                        console.log('Статья успешно создана и сохранена!');
                    } else {
                        console.error('Ошибка при создании статьи:', response.statusText);
                    }
                })
                .catch(function(error) {
                    console.error('Ошибка при отправке запроса:', error);
                });
            document.location.href = "/"
        }
    </script>


    {{template "footer" }}

{{end}}
